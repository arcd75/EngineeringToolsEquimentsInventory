// JavaScript Document
window.onload = function(){
	"use strict";
	
	//数据
	var datas = {
		CID : null,
		nowID : $('.productID').val(),
		sameJson : [], // 同类型产品信息集合
		sameArr : [], // 相同类型
		load : function(){
			this.getData();
		},
		ajax : function(val){
			$.post('../files/lib_18/db/sameModel.php',{ID:val.id},function(data){
				if(data.indexOf("size") > 0){
					var img = val.img.replace(/(^\s*)|(\s*$)/g, "");
					data = $.parseJSON(data);
					var _proImg = '',url = 'product_display';
					if(val.name.indexOf('/')){
						 _proImg = val.name.replace('/','-');
					}
					var productType = data.type.replace("HD/FHD,","");
					productType = productType.replace(",HD/FHD","");
					productType = productType.replace("HD/FHD","");
					var str= '<li><a href="'+url+'.php?id='+val.id+'"><div class="img-s"><img  onerror="onErrorImg(this);" src="upload_files/newProductImg/'+_proImg+'.png" alt=""></div><div class="product-mes"><div class="mesTop"><span class="name">'+val.name+'</span><p class="price"><sub>$</sub><span>'+val.price+'</span></p></div><div class="mesBot">'+data.size + ' inch ' + productType + ' Monitor </div></div></a></li>';
					$('.suggest ul').append(str);
					$('.suggest').show();
				}else{
					$('.similar').remove();
				}
				
			})	
		},
		getData : function(){
			//得到当前类型
			for(var i=0;i<productIDs.length;i++){
				if(productIDs[i] == this.nowID){
					this.CID = productKind[i];
				}
			}
			//获取抛出自身外同类型id
			for(var j=0;j<productKind.length;j++){
				if(productKind[j] == this.CID){
					if(productIDs[j] != this.nowID){
						var _json = {id:productIDs[j],img:productImages[j],name:productNames[j],isNew:productNew[j],price:'88'}
						this.sameJson.push(_json);
					}
				}
			}
			//生成节点
			var showName = ['I2381FH','I2781FH','E2461FWH','I2769VM','E970SWN','E970SWNL','E1670SWU','E2070SWN','E2070SWNE','E2180SWN','E2250SWDN','E2270SWDN','E2470SWH','M2060SWD','M2461FWH','AG271QG','AG271QX','AG322FCX','G2460PF','G2460VQ6','G2770PF','G2778VQ','I2280SWD','Q3279VWF8'];
			var num = 0;
			for(var k=0;k<this.sameJson.length;k++){
				var val = this.sameJson[k];
				if(!in_array(val.name,showName)){continue};
				num ++;
				if(num <= 3){
					this.ajax(val);	
				}
			}
		}
	}
	datas.load(); //初始化
	
	//功能
	$('body,html').animate({scrollTop:0},10);
	$(window).scroll(function(){
		var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;　　//scrollTop就是触发滚轮事件时滚轮的高度
		if(scrollTop > $('.content').offset().top - 50){
			$('nav').fadeIn();
		}else{
			$('nav').fadeOut();
		}
	});
	$('nav li').click(function(){
		var _index = $(this).index();
		if(_index == 1 || _index == 2){
			$('.bannerImg img').css({marginTop : '160px'});
		}else{
			$('.bannerImg img').css({marginTop : '0'});
		}
		$(this).addClass('active').siblings('li').removeClass('active');
		$('.content'+_index).show().siblings('.content').hide();
		$('body,html').animate({scrollTop:($('.scrollHref').offset().top - 150) * zoomScale},10);
	})
	
	
}


//on error samemodal 的判断
function onErrorImg(myimg)
{
     var curr_src = $(myimg).attr("src");
     if(curr_src.indexOf("https://www.aocmonitorap.com/")>-1)
     {  
     	$(myimg).attr("onerror", null);  
     	myimg.style="visibility: hidden;height:0;width:0"
	 }
     else {
     	if(curr_src.indexOf("../")==0) curr_src = curr_src.substr(3);
     	$(myimg).attr("src","https://www.aocmonitorap.com/aoc_public/"+curr_src); 
     } 
}
//zhl end 


